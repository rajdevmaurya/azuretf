name: Terraform Plan

on: 
  push:
   branches:
     - main

jobs:
  terraform:
    runs-on: ubuntu-latest

    env:
      ARM_CLIENT_ID: ${{secrets.ARM_CLIENT_ID}}
      ARM_CLIENT_SECRET: ${{secrets.MYSUPERSECRETE}}
      ARM_SUBSCRIPTION_ID: ${{secrets.MYSBSCRIPTIONID}}
      ARM_TENANT_ID: ${{secrets.ARM_TENANT_ID}}
      SSH_PUBLIC_KEY: ${{ secrets.SSH_PUBLIC_KEY }}

    steps:
      - uses: actions/checkout@v2

      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v1

      - name: Terraform Init
        run: terraform init

      - name: Terraform Plan
        run: terraform plan -var "location=${{ secrets.LOCATION }}" -var "resource_group_name=${{ secrets.RESOURCE_GROUP_NAME }}" -var "service_principal_name=${{ secrets.SERVICE_PRINCIPAL_NAME }}" -var "client_id=${{ secrets.ARM_CLIENT_ID }}" -var "client_secret=${{ secrets.ARM_CLIENT_SECRET }}" -var "ssh_public_key=${{ secrets.SSH_PUBLIC_KEY }}"
